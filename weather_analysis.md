# 天气模拟参数分析表格

| 天气类型 | 模拟方式 | 主要超参数 | 具体数值 | 处理策略 |
|---------|---------|-----------|---------|---------|
| **Snow (雪天)** | 添加随机噪声点 + 掩码遮挡 | 随机点数量 | 1800个 | 在原点云基础上添加随机噪声点 |
| | | X坐标范围 | [-15, 15] × random_multiplier | 随机扰动范围 |
| | | Y坐标范围 | [-15, 15] × random_multiplier | 随机扰动范围 |
| | | Z坐标范围 | [-10, 0.8] × random_multiplier | 高度扰动范围 |
| | | 噪声强度 | 0.005 | 添加到深度通道的噪声 |
| | | 掩码概率1 | 0.8 (bernoulli) | mask_mask_1 概率 |
| | | 掩码概率2 | 0.9 (bernoulli) | mask_1 概率 |
| | | 深度阈值 | < 0.13 | 噪声添加条件 |
| **Fog (雾天)** | 添加大量噪声点 + 多层掩码 | 随机点数量 | 5500个 | 比雪天更多的噪声点 |
| | | 坐标扰动范围 | 同雪天 | X,Y: [-15,15], Z: [-10,0.8] |
| | | 噪声强度 | 0.005 | 同雪天 |
| | | 噪声掩码概率 | 0.8 (bernoulli) | mask_mask_noise |
| | | 衰减掩码概率1 | 0.3 (bernoulli) | mask_mask_2 |
| | | 衰减掩码概率2 | 0.55 (bernoulli) | mask_mask_3 |
| | | 衰减掩码概率3 | 0.8 (bernoulli) | mask_mask_atten |
| | | 深度阈值1 | > 0.03 | fog_atten_out 条件 |
| | | 深度阈值2 | < 0.03 | fog_atten_in 条件 |
| | | 深度阈值3 | > 0.14 | 最终掩码条件 |
| **Rain (雨天)** | 基于高度和深度的掩码遮挡 | 掩码概率1 | 0.3 (bernoulli) | mask_mask_1 |
| | | 掩码概率2 | 0.2 (bernoulli) | mask_mask_2 |
| | | 掩码概率3 | 0.5 (bernoulli) | mask_mask_3 |
| | | 高度阈值 | > -1.2 | 地面以上区域 |
| | | 深度阈值1 | < 0.2 | 近距离雨滴效应 |
| | | 深度阈值2 | > 0.08 | 远距离处理 |
| | | 深度阈值3 | < 0.08 | 近距离处理 |
| **Wet Ground (湿地面)** | 地面反射模拟 | 掩码概率1 | 0.5 (bernoulli) | mask_mask_1 |
| | | 掩码概率2 | 0.2 (bernoulli) | mask_mask_2 |
| | | 高度阈值 | > -1.2 | 地面以上保持 |
| | | 深度阈值 | > 0.06 | 近距离地面反射 |
| **Normal (正常)** | 无处理 | 无 | 无 | 直接使用原始数据 |

## 反射强度处理策略

| 天气类型 | 反射强度处理方式 | 说明 |
|---------|----------------|------|
| Snow/Fog | `ref = depth` | 直接使用深度值作为反射强度 |
| Rain/Wet Ground | 保持原始 | 使用原始反射强度数据 |
| Normal | 保持原始 | 完全保持原始数据 |

## 关键处理流程

### Snow/Fog 天气处理流程：
1. 从原始点云提取XYZ坐标
2. 生成大量随机噪声点（雪天1800个，雾天5500个）
3. 将噪声点与原始点云合并
4. 重新投影到range image
5. 使用深度作为反射强度
6. 应用多层随机掩码进行遮挡

### Rain/Wet Ground 天气处理流程：
1. 基于高度和深度信息生成掩码
2. 使用多个伯努利分布生成随机掩码
3. 直接对原始数据应用掩码遮挡
4. 保持原始反射强度不变

## 数据文件依赖

对于fog、snow、rain天气，`stf_process`函数还依赖外部数据文件：
- `./seeingthroughfog/dense_fog_day.txt`
- `./seeingthroughfog/snow_day.txt` 
- `./seeingthroughfog/rain.txt`
- `./seeingthroughfog/lidar_hdl64_strongest/` 目录下的.bin文件